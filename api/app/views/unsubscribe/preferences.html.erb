<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Preferences - XSpaceGrow</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #2d3748;
      background-color: #f7fafc;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
    }
    
    .content {
      padding: 40px 30px;
    }
    
    .intro {
      margin-bottom: 30px;
      padding: 20px;
      background-color: #f0fff4;
      border-left: 4px solid #10b981;
      border-radius: 4px;
    }
    
    .intro p {
      margin: 0;
      color: #2d3748;
    }
    
    .preferences-form {
      margin-bottom: 30px;
    }
    
    .form-group {
      margin-bottom: 25px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background-color: #f8fafc;
    }
    
    .form-group h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #2d3748;
    }
    
    .form-group p {
      font-size: 14px;
      color: #718096;
      margin-bottom: 15px;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 12px;
      accent-color: #667eea;
    }
    
    .checkbox-group label {
      font-size: 16px;
      color: #2d3748;
      cursor: pointer;
      flex: 1;
    }
    
    .checkbox-group small {
      display: block;
      font-size: 13px;
      color: #718096;
      margin-top: 4px;
      margin-left: 30px;
    }
    
    .buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      min-width: 140px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .btn-secondary {
      background-color: #e2e8f0;
      color: #4a5568;
    }
    
    .btn-secondary:hover {
      background-color: #cbd5e0;
    }
    
    .btn-danger {
      background-color: #fed7d7;
      color: #c53030;
      border: 1px solid #feb2b2;
    }
    
    .btn-danger:hover {
      background-color: #fbb6ce;
    }
    
    .footer {
      background-color: #f8fafc;
      padding: 20px 30px;
      text-align: center;
      border-top: 1px solid #e2e8f0;
      font-size: 14px;
      color: #718096;
    }
    
    .footer a {
      color: #667eea;
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
    
    .alert {
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    
    .alert-success {
      background-color: #f0fff4;
      border: 1px solid #9ae6b4;
      color: #2f855a;
    }
    
    .alert-error {
      background-color: #fed7d7;
      border: 1px solid #feb2b2;
      color: #c53030;
    }
    
    @media (max-width: 600px) {
      .container {
        margin: 10px;
        border-radius: 8px;
      }
      
      .header {
        padding: 30px 20px;
      }
      
      .content {
        padding: 30px 20px;
      }
      
      .buttons {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- Header -->
    <div class="header">
      <h1>ðŸ“§ Email Preferences</h1>
      <p>Customize which emails you receive from XSpaceGrow</p>
    </div>
    
    <!-- Content -->
    <div class="content">
      
      <!-- Flash Messages -->
      <% if flash[:notice] %>
        <div class="alert alert-success">
          <%= flash[:notice] %>
        </div>
      <% end %>
      
      <% if flash[:alert] %>
        <div class="alert alert-error">
          <%= flash[:alert] %>
        </div>
      <% end %>
      
      <!-- Intro -->
      <div class="intro">
        <p>
          Hi <%= @user&.name || 'there' %>! We want to make sure you only receive emails that are valuable to you. 
          Choose which types of emails you'd like to receive, or unsubscribe completely if you prefer.
        </p>
      </div>
      
      <!-- Preferences Form -->
      <%= form_with url: update_preferences_path, method: :patch, class: "preferences-form" do |form| %>
        <%= hidden_field_tag :token, @token %>
        
        <!-- Essential Emails -->
        <div class="form-group">
          <h3>ðŸ”” Essential Account Emails</h3>
          <p>Important updates about your account, security, and service changes.</p>
          <div class="checkbox-group">
            <input type="checkbox" id="essential_emails" name="preferences[essential_emails]" value="1" checked disabled>
            <label for="essential_emails">
              Account & Security Updates
              <small>Required for account security and cannot be disabled</small>
            </label>
          </div>
        </div>
        
        <!-- Product Updates -->
        <div class="form-group">
          <h3>ðŸš€ Product Updates</h3>
          <p>New features, improvements, and important product announcements.</p>
          <div class="checkbox-group">
            <input type="checkbox" id="product_updates" name="preferences[product_updates]" value="1" 
                   <%= 'checked' if @preferences[:product_updates] != false %>>
            <label for="product_updates">
              Feature updates and product news
              <small>Stay informed about new capabilities and improvements</small>
            </label>
          </div>
        </div>
        
        <!-- Marketing Emails -->
        <div class="form-group">
          <h3>ðŸ’¡ Marketing & Promotions</h3>
          <p>Special offers, discounts, and promotional campaigns.</p>
          <div class="checkbox-group">
            <input type="checkbox" id="marketing_emails" name="preferences[marketing_emails]" value="1" 
                   <%= 'checked' if @preferences[:marketing_emails] != false %>>
            <label for="marketing_emails">
              Promotions and special offers
              <small>Get exclusive discounts and seasonal promotions</small>
            </label>
          </div>
        </div>
        
        <!-- Educational Content -->
        <div class="form-group">
          <h3>ðŸ“š Educational Content</h3>
          <p>Tips, best practices, case studies, and industry insights.</p>
          <div class="checkbox-group">
            <input type="checkbox" id="educational_emails" name="preferences[educational_emails]" value="1" 
                   <%= 'checked' if @preferences[:educational_emails] != false %>>
            <label for="educational_emails">
              Tips and best practices
              <small>Learn how to get the most out of IoT monitoring</small>
            </label>
          </div>
        </div>
        
        <!-- Nurture Campaigns -->
        <div class="form-group">
          <h3>ðŸŒ± Onboarding & Guidance</h3>
          <p>Helpful emails to get you started and maximize your success.</p>
          <div class="checkbox-group">
            <input type="checkbox" id="nurture_emails" name="preferences[nurture_emails]" value="1" 
                   <%= 'checked' if @preferences[:nurture_emails] != false %>>
            <label for="nurture_emails">
              Getting started guidance
              <small>Onboarding tips and success strategies</small>
            </label>
          </div>
        </div>
        
        <!-- Email Frequency -->
        <div class="form-group">
          <h3>ðŸ“… Email Frequency</h3>
          <p>How often would you like to receive marketing and educational emails?</p>
          <div style="margin-top: 15px;">
            <div class="checkbox-group">
              <input type="radio" id="freq_weekly" name="preferences[email_frequency]" value="weekly" 
                     <%= 'checked' if @preferences[:email_frequency] == 'weekly' || @preferences[:email_frequency].nil? %>>
              <label for="freq_weekly">Weekly (recommended)</label>
            </div>
            <div class="checkbox-group">
              <input type="radio" id="freq_biweekly" name="preferences[email_frequency]" value="biweekly" 
                     <%= 'checked' if @preferences[:email_frequency] == 'biweekly' %>>
              <label for="freq_biweekly">Every 2 weeks</label>
            </div>
            <div class="checkbox-group">
              <input type="radio" id="freq_monthly" name="preferences[email_frequency]" value="monthly" 
                     <%= 'checked' if @preferences[:email_frequency] == 'monthly' %>>
              <label for="freq_monthly">Monthly only</label>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="buttons">
          <button type="submit" class="btn btn-primary">
            Save Preferences
          </button>
          <%= link_to unsubscribe_path(token: @token), class: "btn btn-secondary" do %>
            View All Options
          <% end %>
        </div>
        
      <% end %>
      
      <!-- Unsubscribe All -->
      <div style="margin-top: 30px; padding: 20px; background-color: #fef5e7; border: 1px solid #f6d55c; border-radius: 8px; text-align: center;">
        <h4 style="color: #744210; margin-bottom: 10px;">Want to unsubscribe from everything?</h4>
        <p style="color: #9c4221; margin-bottom: 15px; font-size: 14px;">
          You'll still receive essential account and security emails, but no marketing or educational content.
        </p>
        <%= link_to unsubscribe_complete_path(token: @token), 
                    method: :delete,
                    class: "btn btn-danger",
                    onclick: "return confirm('Are you sure you want to unsubscribe from all marketing emails?')" do %>
          Unsubscribe from All
        <% end %>
      </div>
      
    </div>
    
    <!-- Footer -->
    <div class="footer">
      <p>
        Questions about these preferences? 
        <a href="mailto:support@xspacegrow.com">Contact our support team</a>
      </p>
      <p style="margin-top: 10px;">
        <a href="<%= root_url %>">Return to XSpaceGrow</a> | 
        <a href="mailto:privacy@xspacegrow.com">Privacy Policy</a>
      </p>
    </div>
    
  </div>
</body>
</html>